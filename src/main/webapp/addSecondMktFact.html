<html><head><title>Add VC Round Record</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
<link rel="stylesheet" type="text/css" href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.19/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="http://dev.jtsage.com/cdn/datebox/latest/jquery.mobile.datebox.min.css" />
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.2.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.19/jquery-ui.min.js"></script>
<script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
<script type="text/javascript" src="http://dev.jtsage.com/cdn/datebox/latest/jquery.mobile.datebox.min.js"></script>
<script type="text/javascript" src="http://dev.jtsage.com/cdn/datebox/i8n/jquery.mobile.datebox.i8n.en.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
     var today = new Date();
     var todayMonth = today.getMonth()+1;
     var thirtyDaysAgo = new Date((new Date()).getTime()-30*60*60*24*1000);
     if ( todayMonth < 10 ) todayMonth = "0"+todayMonth;
     var thirtyDaysAgoMonth = thirtyDaysAgo.getMonth()+1;
     if ( thirtyDaysAgoMonth < 10 ) thirtyDaysAgoMonth = "0"+thirtyDaysAgoMonth;
     var lastFundingDateDefault = today.getFullYear() + '-' + todayMonth + '-01';
     var maxDateDefault = thirtyDaysAgo.getFullYear() + '-' + thirtyDaysAgoMonth + '-01';
     var minDateDefault = (thirtyDaysAgo.getFullYear()-1) + '-' + thirtyDaysAgoMonth + '-01';    
     var uniqueVisitorsDefault = "0";
     var visitorGrowthDefault = "0.0";

    $("#lastFundingDateInput").attr("value",lastFundingDateDefault);
    $("#maxDateInput").attr("value",maxDateDefault);
    $("#minDateInput").attr("value",minDateDefault);
    $("#uniqueVisitorsInput").attr("value",uniqueVisitorsDefault);
    $("#visitorGrowthInput").attr("value",visitorGrowthDefault);

     var states = new Array( 'AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','PR','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY' );
     var stateNames = new Array('Alabama','Alaska','Arizona','Arkansas','California','Colorado','Connecticut','Delaware','Florida','Georgia','Hawaii','Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky','Louisiana','Maine','Maryland','Massachusetts', 'Michigan','Minnesota','Mississippi','Missouri','Montana','Nebraska','Nevada','New Hampshire','New Jersey','New Mexico','New York','North Carolina','North Dakota','Ohio','Oklahoma','Oregon','Pennsylvania','Puerto Rico','Rhode Island','South Carolina','South Dakota','Tennessee','Texas','Utah','Vermont','Virginia','Washington','West Virginia','Wisconsin','Wyoming');

     for ( var i=0; i<states.length; i++ ) {
       $("#stateSelect").append( $('<option value="'+states[i]+'" id="'+states[i]+'">'+states[i]+' - '+stateNames[i]+'</option>') );
     }
     $("#CA").attr("selected",true);
     $("#stateSelect").attr("selectedIndex",5);
     $("#stateSelect").selectmenu("refresh");

     $("#addAnotherAnchor").click(function(){
       $("#companyNameInput").attr("value","");
       $("#cityInput").attr("value","");
       $("#companyUrlInput").attr("value","");
       $("#lastFundingAmountInput").attr("value","");
       $("#secondMarketUrlInput").attr("value","");
       $("#uniqueVisitorsInput").attr("value","0");
       $("#visitorGrowthInput").attr("value","0.0");

       $.mobile.changePage("#formPage", {transition:"slide"});
     });

     $("#indexPageAnchor").click(function(){
        $(location).attr('href','./index.html');
     });

     //autocomplete for cities input
     $("#cityInput").autocomplete({ source: [ 'San Francisco', 'Mountain View', 'Palo Alto', 'San Diego', 'Sunnyvale', 'San Jose', 'Los Angeles', 'Santa Clara', 'San Mateo', 'Redwood City', 'Menlo Park', 'Fremont', 'Santa Monica', 'Irvine', 'Cupertino', 'Pleasanton', 'Milpitas', 'Campbell', 'South San Francisco', 'Santa Barbara', 'Oakland', 'La Jolla', 'Carlsbad', 'San Carlos', 'Pasadena', 'Berkeley', 'Emeryville', 'Burlingame', 'Los Gatos', 'Foster City', 'Aliso Viejo', 'Hayward', 'El Segundo', 'Los Altos', 'San Bruno', 'Redwood Shores', 'Torrance', 'San Ramon', 'Beverly Hills', 'Venice', 'Newport Beach', 'Hollywood', 'Sacramento', 'Newark', 'Livermore', 'Saratoga', 'West Hollywood', 'Belmont', 'Sausalito', 'Culver City', 'San Rafael', 'Goleta', 'Alameda', 'Sherman Oaks', 'Burbank', 'Woodland Hills', 'San Clemente', 'Santa Ana', 'Mill Valley', 'Novato', 'Calabasas', 'Petaluma', 'Brisbane', 'Laguna Hills', 'Solana Beach', 'Marina Del Rey', 'Santa Cruz', 'Walnut Creek', 'Costa Mesa', 'Folsom', 'Santa Rosa', 'Monrovia', 'Glendale', 'Roseville', 'Manhattan Beach', 'Encino', 'San Luis Obispo', 'Lake Forest', 'San Leandro', 'Encinitas', 'Agoura Hills', 'El Dorado Hills', 'Camarillo' ]});

  });
</script>
<script type="text/javascript">
 function showSuccessDialog( _addedRecord ) {
   $.each($("#companyNameDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#cityDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#stateDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#lastFundingDateDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#lastFundingAmountDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#minDateDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#maxDateDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#secondMarketUrlDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#uniqueVisitorsDialog").children(),function(){
      $(this).detach();
   });
   $.each($("#visitorGrowthDialog").children(),function(){
      $(this).detach();
   });

   $("#companyNameDialog").append( $('<label>Company Name:</label><label style="position:absolute;left:200px;">'+_addedRecord.companyName+'</label>') );
   $("#cityDialog").append( $('<label>City:</label><label style="position:absolute;left:200px;">'+_addedRecord.city+'</label>') );
   $("#stateDialog").append( $('<label>State:</label><label style="position:absolute;left:200px;">'+_addedRecord.state+'</label>') );
   $("#lastFundingDateDialog").append( $('<label>Last Funding Date:</label><label style="position:absolute;left:200px;">'+_addedRecord.lastFundingDate+'</label>' ) );
   $("#lastFundingAmountDialog").append( $('<label>Last Funding Amt:</label><label style="position:absolute;left:200px;">'+_addedRecord.lastFundingAmount+'</label>' ) );
   $("#minDateDialog").append( $('<label>Min Date:</label><label style="position:absolute;left:200px;">'+_addedRecord.minMonth+'</label>' ) );
   $("#maxDateDialog").append( $('<label>Max Date:</label><label style="position:absolute;left:200px;">'+_addedRecord.maxMonth+'</label>' ) );
   $("#secondMarketUrlDialog").append( $('<label>Second Mkt URL:</label><label style="position:absolute;left:200px;">'+_addedRecord.secondMarketUrl+'</label>' ) );
   $("#uniqueVisitorsDialog").append( $('<label>Unique Visitors:</label><label style="position:absolute;left:200px;">'+_addedRecord.uniqueVisitors+'</label>' ) );
   $("#visitorGrowthDialog").append( $('<label>Visitor Growth:</label><label style="position:absolute;left:200px;">'+_addedRecord.visitorGrowth+'</label>' ) );
   
   $.mobile.changePage("#successDialog", {transition:"slide"});
 }

 function doSubmit( _getQuery ) {
   //do ajax post of the data here.
   //if the post is successful tell the browser to show the success dialog.
   var getRequest = './addSecondMarketFact.action?companyName='+_getQuery.companyName+'&city='+_getQuery.city+'&state='+_getQuery.state+'&companyUrl='+encodeURIComponent(_getQuery.companyUrl)+'&lastFundingDate='+_getQuery.lastFundingDate+'&lastFundingAmount='+_getQuery.lastFundingAmount+'&minDate='+_getQuery.minDate+'&maxDate='+_getQuery.maxDate+'&secondMarketUrl='+encodeURIComponent(_getQuery.secondMarketUrl)+'&uniqueVisitors='+_getQuery.uniqueVisitors+'&visitorGrowth='+_getQuery.visitorGrowth;
   $.getJSON( getRequest, function(data){
      if ( data.status == 'success' ) {
        showSuccessDialog( data.records[0] );
      }
   });
 }

 function validateAndPostForm() {
     //check each mandatory field
     //if mandatory fields are missing or blank highlight in red.
     var getQuery = new Object();
     getQuery.companyName = $.trim( $("#companyNameInput").val() );
     getQuery.city = $.trim( $("#cityInput").val() );
     getQuery.state = $.trim( $("#stateSelect").val() );
     getQuery.companyUrl = $.trim( $("#companyUrlInput").val() );
     getQuery.lastFundingDate = $.trim( $("#lastFundingDateInput").val() );
     getQuery.lastFundingAmount = $.trim( $("#lastFundingAmountInput").val() );
     getQuery.minDate = $.trim( $("#minDateInput").val() );
     getQuery.maxDate = $.trim( $("#maxDateInput").val() );
     getQuery.secondMarketUrl = $.trim( $("#secondMarketUrlInput").val() );
     getQuery.uniqueVisitors = $.trim( $("#uniqueVisitorsInput").val() );
     getQuery.visitorGrowth = $.trim( $("#visitorGrowthInput").val() );
     var badField = true;

     if ( getQuery.companyName == "" ) {
       $("#companyNameLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false;
     }
     else {  $("#companyNameLbl").attr("style",""); }
     if ( getQuery.city == "" ) {
       $("#cityLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false;
     } else {  $("#cityLbl").attr("style",""); }
     if ( getQuery.state == "" ) {
       $("#stateLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false;
     } else { $("#stateLbl").attr("style",""); }
     if ( getQuery.companyUrl == "" ) {
       $("#companyUrlLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false;
     } else { $("#companyUrlLbl").attr("style",""); }
     if ( getQuery.lastFundingDate == "" ) {
       $("#lastFundingDateLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false; 
     } else { $("#lastFundingDateLbl").attr("style",""); }
     if ( getQuery.lastFundingAmount == "" ) { 
       $("#lastFundingAmountLbl").attr("style","font-weight:bold;font-style:italic;color:red;");
       badField = false; 
     } else { $("#lastFundingAmountLbl").attr("style",""); }

     if ( !badField ) {
       alert( "Please correct the input for the fields marked in red." );
     } else {
        doSubmit( getQuery );
     }
  }
</script>
</head><body> 
<div data-role="page" id="formPage" data-theme="b">
 <div data-role="header">
   <h1>Add VC Round Record</h1>
 </div>
 <div data-role="content" data-theme="b">
   <div class="content-primary" id="primaryContent">
   <form>
   <ul data-role="listview" id="recordListView" data-inset="true">
    <li data-role="fieldcontain">
      <a><label for="companyNameInput" style="font-weight:bold;">Company Name:</label>
      <input type="text" name="companyName" id="companyNameInput"></input></a>
    </li>
    <li data-role="fieldcontain">
      <a><label for="cityInput" style="font-weight:bold;">City:</label>
      <input type="text" name="city" id="cityInput"></input></a>
    </li>
    <li data-role="fieldcontain">
      <a><label for="stateSelect" style="font-weight:bold;">State:</label>
      <select name="state" id="stateSelect" data-theme="a"></select></a>
    </li>
    <li data-role="fieldcontain">
      <a><label for="companyUrlInput" style="font-weight:bold;">Company URL:</label>
      <input type="text" name="companyUrl" id="companyUrlInput"></input></a>
    </li>
    <li data-role="fieldcontain">
      <a><label for="lastFundingDateInput" style="font-weight:bold;">Last Funding Date:</label>
      <input name="lastFundingDate" id="lastFundingDateInput" type="date" data-role="datebox" data-options='{"mode":"calbox","dateFormat":"%Y-%m-%d"}'></input></a>
    </li>
    <li data-role="fieldcontain">
      <a><label for="lastFundingAmountInput" style="font-weight:bold;">Last Funding Amount:</label>
      <input type="text" name="lastFundingAmount" id="lastFundingAmountInput"></input></a>
    </li>
   <li data-role="fieldcontain">
      <a><label for="minDateInput" style="font-weight:bold;">Min Date:</label>
      <input name="minDate" id="minDateInput" type="date" data-role="datebox" data-options='{"mode":"calbox","dateFormat":"%Y-%m-%d"}'></input></a>
    </li>
   <li data-role="fieldcontain">
      <a><label for="maxDateInput" style="font-weight:bold;">Max Date:</label>
      <input name="maxDate" id="maxDateInput" type="date" data-role="datebox" data-options='{"mode":"calbox","dateFormat":"%Y-%m-%d"}'></input></a>
   </li>
   <li data-role="fieldcontain">
      <a><label for="secondMarketUrlInput" style="font-weight:bold;">SecondMarket URL:</label>
      <input type="text" name="secondMarketUrl" id="secondMarketUrlInput"></input></a>
   </li>
   <li data-role="fieldcontain">
      <a><label for="uniqueVisitorsInput" style="font-weight:bold;">Unique Visitors:</label>
      <input type="text" name="uniqueVisitors" id="uniqueVisitorsInput"></input></a>
   </li>
   <li data-role="fieldcontain">
      <a><label for="visitorGrowthInput" style="font-weight:bold;">Visitor Growth:</label>
      <input type="text" name="visitorGrowth" id="visitorGrowthInput"></input></a>
    </li>
    <li class="ui-body ui-body-b">
      <a><button type="submit" data-theme="a" onclick="validateAndPostForm();">Add Record</button></a>
    </li>
  </ul>
  </form>
  </div>
 </div>
 <div data-role="footer">
   <h2>&copy; 2012 MktNeutral.com</h2>
 </div>
</div>
<div data-role="page" id="successDialog" data-theme="b">
 <div data-role="header">
   <h1>Record Added Successfully</h1>
 </div>
 <div data-role="content" data-theme="b">
   <div class="content-primary" id="primaryContent">
    <ul data-role="listview" id="recordListView" data-inset="true">
      <li data-role="fieldcontain">
        <a href="#" id="companyNameDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="cityDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="stateDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="lastFundingDateDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="lastFundingAmountDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="minDateDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="maxDateDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="secondMarketUrlDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="uniqueVisitorsDialog"></a>
      </li>
      <li data-role="fieldcontain">
        <a href="#" id="visitorGrowthDialog"></a>
      </li>
    </ul>
    <div align="center"><a href="#" data-role="button" id="addAnotherAnchor">Add Another Record</a></div>
    <div align="center"><a href="#" data-role="button" id="indexPageAnchor">Go to VC Round List Browser</a></div>
   </div>
 </div>
 <div data-role="footer">
   <h2>&copy; 2012 MktNeutral.com</h2>
 </div>
</div>
</body></html>